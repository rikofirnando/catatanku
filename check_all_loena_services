services=(
  "tomcat_payment_receiver/0|tomcat_payment_receiver/tomcat0|/apps/loena2/logs/frontend/tomcat_payment_receiver/0/debug.log"
  "tomcat_payment_receiver/1|tomcat_payment_receiver/tomcat1|/apps/loena2/logs/frontend/tomcat_payment_receiver/1/debug.log"
  "tomcat_loan_record/0|tomcat_loan_record/tomcat0|/apps/loena2/logs/frontend/tomcat_loan_record/0/debug.log"
  "tomcat_loan_record/1|tomcat_loan_record/tomcat1|/apps/loena2/logs/frontend/tomcat_loan_record/1/debug.log"
  "tomcat_bi_receiver/0|tomcat_bi_receiver/tomcat0|/apps/loena2/logs/frontend/tomcat_bi_receiver/0/debug.log"
  "tomcat_bi_receiver/1|tomcat_bi_receiver/tomcat1|/apps/loena2/logs/frontend/tomcat_bi_receiver/1/debug.log"
  "tomcat_mb_receiver/0|tomcat_mb_receiver/tomcat0|/apps/loena2/logs/frontend/tomcat_mb_receiver/0/debug.log"
  "tomcat_mb_receiver/1|tomcat_mb_receiver/tomcat1|/apps/loena2/logs/frontend/tomcat_mb_receiver/1/debug.log"
  "tomcat_cls/0|tomcat_cls/tomcat0|/apps/loena2/logs/frontend/tomcat_cls/0/debug.log"
  "tomcat_cls/1|tomcat_cls/tomcat1|/apps/loena2/logs/frontend/tomcat_cls/1/debug.log"
  "be_suspend|be_suspend|/apps/loena2/logs/backend/be_suspend/0/debug.log"
  "be_bd_bi/0|be_bd_bi|/apps/loena2/logs/backend/be_bd_bi/0/debug.log"
  "be_bd_bi/1|be_bd_bi|/apps/loena2/logs/backend/be_bd_bi/1/debug.log"
  "be_bd_bi/2|be_bd_bi|/apps/loena2/logs/backend/be_bd_bi/2/debug.log"
  "be_bd_bi/3|be_bd_bi|/apps/loena2/logs/backend/be_bd_bi/3/debug.log"
  "be_bd_bi/4|be_bd_bi|/apps/loena2/logs/backend/be_bd_bi/4/debug.log"
  "be_bd_tc/0|be_bd_tc|/apps/loena2/logs/backend/be_bd_tc/0/debug.log"
)


function relative() {
    local last_unix="$(date --date="$1" +%s)"    # convert date to unix timestamp
    local now_unix="$(date +'%s')"

    local delta=$(( $now_unix - $last_unix ))

    if (( $delta < 60 ))
    then
        echo $delta" seconds ago"
        return
    elif ((delta < 2700))  # 45 * 60
    then
        echo $(( $delta / 60 ))" minutes ago";
    else
        echo $(( $delta / 60 / 60))" hours ago";
    fi
}


echo "Check All Service -->"

for i in "${services[@]}"
do
  IFS='|' read -r -a data <<< "$i"

  host=$(hostname -s)
  date=$(date '+%Y-%m-%d %H:%M:%S')
  ret1=$( ps ax | grep -v "grep" | grep -iw "${data[1]}" | wc -l )
  ret2=$( stat -c %y ${data[2]} | cut -d'.' -f1)
  ret3=$( relative "$ret2")

  echo "$date|${data[0]}|$host:$ret1 services running|${data[2]}|$ret2|$ret3"
done

echo "Done"
